# Billing Cost Pipeline - Example with schema template and email notification
pipeline_id: "billing_cost"
description: "Extract GCP billing cost data with schema template and failure notifications"

steps:
  # Step 1: Extract billing data from BigQuery
  - step_id: "extract_billing_cost"
    name: "Extract GCP Billing Cost Data"
    ps_type: "gcp.bigquery_to_bigquery"
    source:
      bq_project_id: "gac-prod-471220"
      query: |
        SELECT
          billing_account_id,
          cost
        FROM `gac-prod-471220.cloudact_cost_usage.gcp_billing_export_resource_v1_01ECB7_6EE0BA_7357F1`
        LIMIT 2
    destination:
      bq_project_id: "gac-prod-471220"
      dataset_type: "gcp"
      table: "billing_cost_data"
      write_mode: "overwrite"
      schema_template: "billing_cost"  # Uses template from schema_template.json

  # Step 2: Send notification on failure
  - step_id: "notify_on_failure"
    name: "Email Notification on Failure"
    ps_type: "shared.email_notification"
    trigger: "on_failure"
    to_emails: "guru.kallam@gmail.com"
    subject: "Pipeline billing_cost Failed"
    message: "The billing cost pipeline has failed. Please check the logs."
