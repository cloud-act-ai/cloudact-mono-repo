# DeepSeek Usage & Cost Pipeline
# Extracts usage from DeepSeek API, calculates cost, stores in BigQuery
#
# Schedule: Daily at 02:00 UTC
# Tables: deepseek_usage_raw, deepseek_cost

pipeline_id: "{org_slug}-deepseek-usage-cost"
name: "DeepSeek Usage & Cost Sync"
description: "Extract usage from DeepSeek API, calculate costs, store in BigQuery"
version: "1.0.0"

# Schedule configuration
schedule:
  type: daily
  time: "02:00"
  timezone: UTC

variables:
  org_slug: "{org_slug}"
  provider: "deepseek"

steps:
  # Step 1: Extract raw usage from DeepSeek API
  - step_id: "extract_usage"
    ps_type: "deepseek.usage"
    description: "Fetch usage data from DeepSeek API"
    config:
      start_date: "{start_date}"
      end_date: "{end_date}"
      destination_table: "deepseek_usage_daily_raw"

  # Step 2: Transform usage to cost
  - step_id: "transform_cost"
    ps_type: "deepseek.cost"
    depends_on: "extract_usage"
    description: "Calculate cost from usage data using model pricing"
    config:
      source_table: "deepseek_usage_daily_raw"
      destination_table: "deepseek_cost_daily"
      pricing_source: "deepseek_model_pricing"

requires_auth: true
auth_type: "org_api_key"

tags:
  - usage
  - cost
  - deepseek
  - llm
  - daily
category: "llm_analytics"
