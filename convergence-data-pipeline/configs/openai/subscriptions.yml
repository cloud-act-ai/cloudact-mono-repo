# OpenAI Subscriptions Pipeline
# Extracts subscription/plan data from OpenAI API
#
# Schedule: Monthly on 1st at 03:00 UTC
# Tables: openai_subscriptions_monthly

pipeline_id: "{org_slug}-openai-subscriptions"
name: "OpenAI Subscriptions Sync"
description: "Extract subscription and plan data from OpenAI API"
version: "1.0.0"

# Pipeline-level timeout (minutes)
timeout_minutes: 5

# Schedule configuration
schedule:
  type: monthly
  day_of_month: 1
  time: "03:00"
  timezone: UTC

variables:
  org_slug: "{org_slug}"
  provider: "openai"

steps:
  # Step 1: Extract subscription data from OpenAI API
  - step_id: "extract_subscriptions"
    ps_type: "openai.subscriptions"
    description: "Fetch subscription and organization data from OpenAI API"
    timeout_minutes: 2
    config:
      destination_table: "openai_subscriptions_monthly"
      include_limits: true
      include_usage_limits: true

requires_auth: true
auth_type: "org_api_key"

tags:
  - subscriptions
  - openai
  - llm
  - monthly
category: "llm_analytics"
