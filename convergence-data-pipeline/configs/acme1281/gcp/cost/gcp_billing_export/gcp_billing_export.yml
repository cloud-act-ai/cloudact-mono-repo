pipeline_id: gcp_billing_export
description: "GCP billing export data pipeline for extracting and validating billing data"
version: "1.0.0"

# Runtime parameters (passed in API request)
parameters:
  date: "2025-11-14"  # Default value, can be overridden

steps:
  # Step 1: Extract sample data from BigQuery
  - step_id: extract_sample_data
    type: bigquery_to_bigquery
    description: "Extract sample data from cloudact_cost_usage.cloud_pricing_export"
    source:
      project_id: gac-prod-471220
      dataset: cloudact_cost_usage
      table: gcp_billing_export_v1_01ECB7_6EE0BA_7357F1
      query: |
        SELECT
          billing_account_id,
          transaction_type,
          seller_name,
          cost
        FROM `gac-prod-471220.cloudact_cost_usage.gcp_billing_export_v1_01ECB7_6EE0BA_7357F1`
        LIMIT 10
    destination:
      dataset_type: gcp
      table: example_output
      write_mode: overwrite
      recreate: true  # Delete and recreate table on each run
      schema_file: "gcp_billing_export_output_schema.json"

  # Step 2: Validate output data quality
  - step_id: validate_output
    type: data_quality
    description: "Validate output data quality"
    source:
      dataset_type: gcp
      table: example_output
    dq_config: "gcp_billing_export_dq.yml"
    fail_on_error: false  # Don't fail pipeline if DQ checks fail (for demo)
    depends_on:
      - extract_sample_data
