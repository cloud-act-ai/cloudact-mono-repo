.PHONY: help docker-build docker-up docker-down docker-logs docker-shell docker-test docker-clean

# Default target
help:
	@echo "Convergence Data Pipeline - Docker Commands"
	@echo ""
	@echo "Available targets:"
	@echo "  make docker-build    - Build Docker image"
	@echo "  make docker-up       - Start services"
	@echo "  make docker-down     - Stop services"
	@echo "  make docker-logs     - View logs"
	@echo "  make docker-shell    - Open shell in container"
	@echo "  make docker-test     - Run automated tests"
	@echo "  make docker-restart  - Restart services"
	@echo "  make docker-clean    - Clean up everything"
	@echo ""

# Build Docker image
docker-build:
	@echo "ğŸ”¨ Building Docker image..."
	docker-compose build

# Start services
docker-up:
	@echo "ğŸš€ Starting services..."
	docker-compose up -d
	@echo "âœ… Services started!"
	@echo "   API: http://localhost:8080"
	@echo "   Health: http://localhost:8080/health"

# Stop services
docker-down:
	@echo "ğŸ›‘ Stopping services..."
	docker-compose down

# View logs
docker-logs:
	@echo "ğŸ“‹ Viewing logs..."
	docker-compose logs -f --tail=100 convergence-api

# Open shell in container
docker-shell:
	@echo "ğŸš Opening shell in container..."
	docker-compose exec convergence-api bash

# Restart services
docker-restart:
	@echo "ğŸ”„ Restarting services..."
	docker-compose restart
	@echo "âœ… Services restarted!"

# Run automated tests
docker-test: docker-up
	@echo "ğŸ§ª Running automated tests..."
	@sleep 5
	./docker-test.sh

# Clean up everything
docker-clean:
	@echo "ğŸ§¹ Cleaning up..."
	docker-compose down -v
	docker system prune -f
	@echo "âœ… Cleanup complete!"

# Build and start
docker-start: docker-build docker-up
	@echo "âœ… Build and start complete!"

# Full test cycle
docker-full-test: docker-clean docker-build docker-test
	@echo "âœ… Full test cycle complete!"
