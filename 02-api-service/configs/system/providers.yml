# Provider Configuration
# Single source of truth for all integration providers
# To add a new provider: just add an entry here - no code changes needed
#
# SUBSCRIPTION STATUS MAPPING:
# Frontend (Supabase) -> Backend (BigQuery)
#   trialing          -> TRIAL
#   active            -> ACTIVE
#   past_due          -> SUSPENDED
#   canceled          -> CANCELLED
#   paused            -> SUSPENDED
#   incomplete        -> SUSPENDED
# Only ACTIVE and TRIAL statuses allow pipeline execution

providers:
  # LLM Providers
  OPENAI:
    type: llm
    credential_type: API_KEY
    display_name: "OpenAI API Key"
    context_key: openai_api_key
    api_base_url: "https://api.openai.com/v1"
    validation_endpoint: "/models"
    auth_header: "Authorization"
    auth_prefix: "Bearer "
    key_prefix:
      - "sk-"
      - "keisk-" # Support for project keys
    # Validation configuration
    validation_model: "gpt-3.5-turbo" # Model used for lightweight validation calls
    # Retry and rate limiting
    max_retries: 3
    retry_backoff_seconds: 2
    rate_limit_per_minute: 60 # Per-org rate limit for this provider
    # Data tables for pricing/subscriptions (unified tables, filter by provider)
    data_tables:
      pricing_table: "llm_model_pricing"
      subscriptions_table: "saas_subscription_plans"
      seed_path: "configs/llm/seed"
      pricing_schema: "llm_model_pricing.json"

  ANTHROPIC:
    type: llm
    credential_type: API_KEY
    display_name: "Anthropic API Key"
    context_key: anthropic_api_key
    api_base_url: "https://api.anthropic.com/v1"
    validation_endpoint: "/models"
    auth_header: "x-api-key"
    auth_prefix: ""
    extra_headers:
      anthropic-version: "2023-06-01"
    # Validation configuration
    validation_model: "claude-3-haiku-20240307" # Model used for lightweight validation calls
    # Retry and rate limiting
    max_retries: 3
    retry_backoff_seconds: 2
    rate_limit_per_minute: 60 # Per-org rate limit for this provider
    # Data tables for pricing/subscriptions (unified tables, filter by provider)
    data_tables:
      pricing_table: "llm_model_pricing"
      subscriptions_table: "saas_subscription_plans"
      seed_path: "configs/llm/seed"
      pricing_schema: "llm_model_pricing.json"

  CLAUDE:
    # Alias for ANTHROPIC (for backward compatibility)
    alias_for: ANTHROPIC # Indicates this is an alias
    type: llm
    credential_type: API_KEY
    display_name: "Claude API Key"
    context_key: claude_api_key
    api_base_url: "https://api.anthropic.com/v1"
    validation_endpoint: "/models"
    auth_header: "x-api-key"
    auth_prefix: ""
    extra_headers:
      anthropic-version: "2023-06-01"
    # Inherits from ANTHROPIC
    validation_model: "claude-3-haiku-20240307"
    max_retries: 3
    retry_backoff_seconds: 2
    rate_limit_per_minute: 60

  GEMINI:
    type: llm
    credential_type: API_KEY
    display_name: "Google Gemini API Key"
    context_key: gemini_api_key
    api_base_url: "https://generativelanguage.googleapis.com/v1beta"
    validation_endpoint: "/models"
    auth_header: ""  # Gemini uses query param for API key
    auth_prefix: ""
    auth_query_param: "key"  # API key passed as ?key=xxx
    key_prefix:
      - "AIza"  # Google API keys start with AIza
    # Validation configuration
    validation_model: "gemini-1.5-flash"  # Fast model for validation
    # Retry and rate limiting
    max_retries: 3
    retry_backoff_seconds: 2
    rate_limit_per_minute: 60  # Per-org rate limit for this provider
    # Data tables for pricing/subscriptions (unified tables, filter by provider)
    data_tables:
      pricing_table: "llm_model_pricing"
      subscriptions_table: "saas_subscription_plans"
      seed_path: "configs/llm/seed"
      pricing_schema: "llm_model_pricing.json"

  DEEPSEEK:
    type: llm
    credential_type: API_KEY
    display_name: "DeepSeek API Key"
    context_key: deepseek_api_key
    api_base_url: "https://api.deepseek.com"
    validation_endpoint: "/models"
    auth_header: "Authorization"
    auth_prefix: "Bearer "
    key_prefix:
      - "sk-"  # DeepSeek API keys start with sk-
    # Validation configuration
    validation_model: "deepseek-chat"  # Model used for lightweight validation calls
    # Retry and rate limiting
    max_retries: 3
    retry_backoff_seconds: 2
    rate_limit_per_minute: 60  # Per-org rate limit for this provider
    # Data tables for pricing/subscriptions (unified tables, filter by provider)
    data_tables:
      pricing_table: "llm_model_pricing"
      subscriptions_table: "saas_subscription_plans"
      seed_path: "configs/llm/seed"
      pricing_schema: "llm_model_pricing.json"

  # Cloud Providers
  GCP_SA:
    type: cloud
    credential_type: SERVICE_ACCOUNT_JSON
    display_name: "GCP Service Account"
    context_key: gcp_sa_json
    required_fields:
      - type
      - project_id
      - private_key
      - client_email
    expected_type: "service_account"
    # Retry and rate limiting
    max_retries: 3
    retry_backoff_seconds: 2
    rate_limit_per_minute: 100 # Higher limit for cloud operations

# Provider groups for easy lookup
provider_groups:
  llm:
    - OPENAI
    - ANTHROPIC
    - CLAUDE # Include CLAUDE alias in LLM group
    - GEMINI
    - DEEPSEEK
  cloud:
    - GCP_SA
  all:
    - OPENAI
    - ANTHROPIC
    - CLAUDE
    - GEMINI
    - DEEPSEEK
    - GCP_SA

# Provider aliases (for normalization)
# Maps user-friendly names to canonical provider names
aliases:
  openai: OPENAI
  anthropic: ANTHROPIC
  claude: CLAUDE
  gemini: GEMINI
  google: GEMINI
  deepseek: DEEPSEEK
  gcp: GCP_SA
  gcp_sa: GCP_SA

# Default settings
defaults:
  http_timeout: 15.0
  validation_timeout: 10.0
  max_retries: 3
  retry_backoff_seconds: 2
  rate_limit_per_minute: 60
