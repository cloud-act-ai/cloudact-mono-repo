# Provider Configuration
# Single source of truth for all integration providers
# To add a new provider: just add an entry here - no code changes needed
#
# SUBSCRIPTION STATUS MAPPING:
# Frontend (Supabase) -> Backend (BigQuery)
#   trialing          -> TRIAL
#   active            -> ACTIVE
#   past_due          -> SUSPENDED
#   canceled          -> CANCELLED
#   paused            -> SUSPENDED
#   incomplete        -> SUSPENDED
# Only ACTIVE and TRIAL statuses allow pipeline execution

providers:
  # GenAI Providers (API-based usage billing)
  OPENAI:
    type: genai
    credential_type: API_KEY
    display_name: "OpenAI API Key"
    context_key: openai_api_key
    api_base_url: "https://api.openai.com/v1"
    validation_endpoint: "/models"
    auth_header: "Authorization"
    auth_prefix: "Bearer "
    key_prefix:
      - "sk-"
      - "keisk-" # Support for project keys
    # Validation configuration
    validation_model: "gpt-3.5-turbo" # Model used for lightweight validation calls
    # Retry and rate limiting
    max_retries: 3
    retry_backoff_seconds: 2
    rate_limit_per_minute: 60 # Per-org rate limit for this provider
    # Data tables for pricing/subscriptions (unified tables, filter by provider)
    data_tables:
      pricing_table: "genai_model_pricing"
      subscriptions_table: "subscription_plans"
      seed_path: "configs/genai/seed"
      pricing_schema: "genai_model_pricing.json"

  ANTHROPIC:
    type: genai
    credential_type: API_KEY
    display_name: "Anthropic API Key"
    context_key: anthropic_api_key
    api_base_url: "https://api.anthropic.com/v1"
    validation_endpoint: "/models"
    auth_header: "x-api-key"
    auth_prefix: ""
    extra_headers:
      anthropic-version: "2023-06-01"
    # Validation configuration
    validation_model: "claude-3-haiku-20240307" # Model used for lightweight validation calls
    # Retry and rate limiting
    max_retries: 3
    retry_backoff_seconds: 2
    rate_limit_per_minute: 60 # Per-org rate limit for this provider
    # Data tables for pricing/subscriptions (unified tables, filter by provider)
    data_tables:
      pricing_table: "genai_model_pricing"
      subscriptions_table: "subscription_plans"
      seed_path: "configs/genai/seed"
      pricing_schema: "genai_model_pricing.json"

  CLAUDE:
    # Alias for ANTHROPIC (for backward compatibility)
    alias_for: ANTHROPIC # Indicates this is an alias
    type: genai
    credential_type: API_KEY
    display_name: "Claude API Key"
    context_key: claude_api_key
    api_base_url: "https://api.anthropic.com/v1"
    validation_endpoint: "/models"
    auth_header: "x-api-key"
    auth_prefix: ""
    extra_headers:
      anthropic-version: "2023-06-01"
    # Inherits from ANTHROPIC
    validation_model: "claude-3-haiku-20240307"
    max_retries: 3
    retry_backoff_seconds: 2
    rate_limit_per_minute: 60

  GEMINI:
    type: genai
    credential_type: API_KEY
    display_name: "Google Gemini API Key"
    context_key: gemini_api_key
    api_base_url: "https://generativelanguage.googleapis.com/v1beta"
    validation_endpoint: "/models"
    auth_header: ""  # Gemini uses query param for API key
    auth_prefix: ""
    auth_query_param: "key"  # API key passed as ?key=xxx
    key_prefix:
      - "AIza"  # Google API keys start with AIza
    # Validation configuration
    validation_model: "gemini-1.5-flash"  # Fast model for validation
    # Retry and rate limiting
    max_retries: 3
    retry_backoff_seconds: 2
    rate_limit_per_minute: 60  # Per-org rate limit for this provider
    # Data tables for pricing/subscriptions (unified tables, filter by provider)
    data_tables:
      pricing_table: "genai_model_pricing"
      subscriptions_table: "subscription_plans"
      seed_path: "configs/genai/seed"
      pricing_schema: "genai_model_pricing.json"

  DEEPSEEK:
    type: genai
    credential_type: API_KEY
    display_name: "DeepSeek API Key"
    context_key: deepseek_api_key
    api_base_url: "https://api.deepseek.com"
    validation_endpoint: "/models"
    auth_header: "Authorization"
    auth_prefix: "Bearer "
    key_prefix:
      - "sk-"  # DeepSeek API keys start with sk-
    # Validation configuration
    validation_model: "deepseek-chat"  # Model used for lightweight validation calls
    # Retry and rate limiting
    max_retries: 3
    retry_backoff_seconds: 2
    rate_limit_per_minute: 60  # Per-org rate limit for this provider
    # Data tables for pricing/subscriptions (unified tables, filter by provider)
    data_tables:
      pricing_table: "genai_model_pricing"
      subscriptions_table: "subscription_plans"
      seed_path: "configs/genai/seed"
      pricing_schema: "genai_model_pricing.json"

  # Cloud Providers
  GCP_SA:
    type: cloud
    credential_type: SERVICE_ACCOUNT_JSON
    display_name: "GCP Service Account"
    context_key: gcp_sa_json
    required_fields:
      - type
      - project_id
      - private_key
      - client_email
    expected_type: "service_account"
    # Retry and rate limiting
    max_retries: 3
    retry_backoff_seconds: 2
    rate_limit_per_minute: 100 # Higher limit for cloud operations

  AWS_IAM:
    type: cloud
    credential_type: AWS_IAM_ROLE
    display_name: "AWS IAM Role (Cross-Account)"
    context_key: aws_iam_role
    required_fields:
      - role_arn
      - external_id
    # Retry and rate limiting
    max_retries: 3
    retry_backoff_seconds: 2
    rate_limit_per_minute: 100

  AWS_KEYS:
    type: cloud
    credential_type: AWS_ACCESS_KEYS
    display_name: "AWS Access Keys"
    context_key: aws_access_keys
    required_fields:
      - access_key_id
      - secret_access_key
    # Retry and rate limiting
    max_retries: 3
    retry_backoff_seconds: 2
    rate_limit_per_minute: 100

  AZURE:
    type: cloud
    credential_type: SERVICE_PRINCIPAL_JSON
    display_name: "Azure Service Principal"
    context_key: azure_sp_json
    required_fields:
      - tenant_id
      - client_id
      - client_secret
      - subscription_id
    # Retry and rate limiting
    max_retries: 3
    retry_backoff_seconds: 2
    rate_limit_per_minute: 100

  OCI:
    type: cloud
    credential_type: OCI_API_KEY
    display_name: "Oracle Cloud API Key"
    context_key: oci_credentials
    required_fields:
      - tenancy_ocid
      - user_ocid
      - fingerprint
      - private_key
      - region
    # Retry and rate limiting
    max_retries: 3
    retry_backoff_seconds: 2
    rate_limit_per_minute: 100

# Provider groups for easy lookup
provider_groups:
  genai:
    - OPENAI
    - ANTHROPIC
    - CLAUDE # Include CLAUDE alias in GenAI group
    - GEMINI
    - DEEPSEEK
  cloud:
    - GCP_SA
    - AWS_IAM
    - AWS_KEYS
    - AZURE
    - OCI
  all:
    - OPENAI
    - ANTHROPIC
    - CLAUDE
    - GEMINI
    - DEEPSEEK
    - GCP_SA
    - AWS_IAM
    - AWS_KEYS
    - AZURE
    - OCI

# Provider aliases (for normalization)
# Maps user-friendly names to canonical provider names
aliases:
  openai: OPENAI
  anthropic: ANTHROPIC
  claude: CLAUDE
  gemini: GEMINI
  google: GEMINI
  deepseek: DEEPSEEK
  gcp: GCP_SA
  gcp_sa: GCP_SA
  aws: AWS_IAM
  aws_iam: AWS_IAM
  aws_keys: AWS_KEYS
  azure: AZURE
  oci: OCI

# Default settings
defaults:
  http_timeout: 15.0
  validation_timeout: 10.0
  max_retries: 3
  retry_backoff_seconds: 2
  rate_limit_per_minute: 60
