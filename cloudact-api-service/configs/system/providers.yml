# Provider Configuration
# Single source of truth for all integration providers
# To add a new provider: just add an entry here - no code changes needed
#
# SUBSCRIPTION STATUS MAPPING:
# Frontend (Supabase) -> Backend (BigQuery)
#   trialing          -> TRIAL
#   active            -> ACTIVE
#   past_due          -> SUSPENDED
#   canceled          -> CANCELLED
#   paused            -> SUSPENDED
#   incomplete        -> SUSPENDED
# Only ACTIVE and TRIAL statuses allow pipeline execution

providers:
  # LLM Providers
  OPENAI:
    type: llm
    credential_type: API_KEY
    display_name: "OpenAI API Key"
    context_key: openai_api_key
    api_base_url: "https://api.openai.com/v1"
    validation_endpoint: "/models"
    auth_header: "Authorization"
    auth_prefix: "Bearer "
    key_prefix: "sk-"  # Used for format validation
    # Validation configuration
    validation_model: "gpt-3.5-turbo"  # Model used for lightweight validation calls
    # Retry and rate limiting
    max_retries: 3
    retry_backoff_seconds: 2
    rate_limit_per_minute: 60  # Per-org rate limit for this provider
    # LLM data tables config (for pricing/subscriptions initialization)
    # NAMING CONVENTION: Schema files follow {provider}_model_pricing.json pattern
    data_tables:
      pricing_table: openai_model_pricing
      subscriptions_table: openai_subscriptions
      seed_path: configs/openai/seed
      pricing_schema: openai_model_pricing.json
      subscriptions_schema: openai_subscriptions.json

  ANTHROPIC:
    type: llm
    credential_type: API_KEY
    display_name: "Anthropic API Key"
    context_key: anthropic_api_key
    api_base_url: "https://api.anthropic.com/v1"
    validation_endpoint: "/models"
    auth_header: "x-api-key"
    auth_prefix: ""
    extra_headers:
      anthropic-version: "2023-06-01"
    # Validation configuration
    validation_model: "claude-3-haiku-20240307"  # Model used for lightweight validation calls
    # Retry and rate limiting
    max_retries: 3
    retry_backoff_seconds: 2
    rate_limit_per_minute: 60  # Per-org rate limit for this provider
    # LLM data tables config
    data_tables:
      pricing_table: anthropic_model_pricing
      subscriptions_table: anthropic_subscriptions
      seed_path: configs/anthropic/seed
      pricing_schema: anthropic_model_pricing.json
      subscriptions_schema: anthropic_subscriptions.json

  CLAUDE:
    # Alias for ANTHROPIC (for backward compatibility)
    alias_for: ANTHROPIC  # Indicates this is an alias
    type: llm
    credential_type: API_KEY
    display_name: "Claude API Key"
    context_key: claude_api_key
    api_base_url: "https://api.anthropic.com/v1"
    validation_endpoint: "/models"
    auth_header: "x-api-key"
    auth_prefix: ""
    extra_headers:
      anthropic-version: "2023-06-01"
    # Inherits from ANTHROPIC
    validation_model: "claude-3-haiku-20240307"
    max_retries: 3
    retry_backoff_seconds: 2
    rate_limit_per_minute: 60

  # Cloud Providers
  GCP_SA:
    type: cloud
    credential_type: SERVICE_ACCOUNT_JSON
    display_name: "GCP Service Account"
    context_key: gcp_sa_json
    required_fields:
      - type
      - project_id
      - private_key
      - client_email
    expected_type: "service_account"
    # Retry and rate limiting
    max_retries: 3
    retry_backoff_seconds: 2
    rate_limit_per_minute: 100  # Higher limit for cloud operations
    # Gemini AI data tables (created when GCP integration is setup)
    # Usage data comes from GCP billing export, subscriptions for tracking
    gemini_data_tables:
      pricing_table: gemini_model_pricing
      subscriptions_table: gemini_subscriptions
      seed_path: configs/gemini/seed
      pricing_schema: gemini_model_pricing.json
      subscriptions_schema: gemini_subscriptions.json

# Provider groups for easy lookup
provider_groups:
  llm:
    - OPENAI
    - ANTHROPIC
    - CLAUDE  # Include CLAUDE alias in LLM group
  cloud:
    - GCP_SA
  all:
    - OPENAI
    - ANTHROPIC
    - CLAUDE
    - GCP_SA

# Provider aliases (for normalization)
# Maps user-friendly names to canonical provider names
aliases:
  openai: OPENAI
  anthropic: ANTHROPIC
  claude: CLAUDE
  gcp: GCP_SA
  gcp_sa: GCP_SA

# Default settings
defaults:
  http_timeout: 15.0
  validation_timeout: 10.0
  max_retries: 3
  retry_backoff_seconds: 2
  rate_limit_per_minute: 60
