# GenAI Unified Consolidation Pipeline
#
# Consolidates all GenAI flows into unified tables and converts to FOCUS 1.3
# Schedule: Daily at 6:00 AM UTC (after all flow pipelines complete)
# URL: POST /api/v1/pipelines/run/{org}/genai/unified/consolidate

pipeline_id: "{org_slug}-genai-unified-consolidate"
name: "GenAI Unified Consolidation"
description: "Consolidate PAYG, Commitment, and Infrastructure costs into unified tables"
provider: "genai"
domain: "unified"
version: "1.0.0"

schedule:
  cron: "0 6 * * *"
  timezone: "UTC"
  enabled: true

steps:
  - step_id: consolidate_usage
    name: "Consolidate Usage Data"
    ps_type: genai.unified_consolidator
    config:
      target: "usage"
    timeout_seconds: 600
    retry:
      max_attempts: 3
      backoff_seconds: 60

  - step_id: consolidate_costs
    name: "Consolidate Cost Data"
    ps_type: genai.unified_consolidator
    config:
      target: "costs"
    depends_on:
      - consolidate_usage
    timeout_seconds: 600
    retry:
      max_attempts: 3
      backoff_seconds: 60

  - step_id: convert_to_focus
    name: "Convert to FOCUS 1.3"
    ps_type: genai.focus_converter
    config: {}
    depends_on:
      - consolidate_costs
    timeout_seconds: 300
    retry:
      max_attempts: 2
      backoff_seconds: 30

notifications:
  on_failure:
    - email
  on_success:
    - email  # Notify on completion of daily consolidation
